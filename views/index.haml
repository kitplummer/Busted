%html{:xmlns => "http://www.w3.org/1999/xhtml", "xml:lang" => "en", :lang => "en"}
    %head 
        :javascript
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2886473-5']);
            _gaq.push(['_trackPageview']);

            (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();

        %title Busted!
    %body
        %h2 Busted: A SunTran WebWatch Feed Proxy
        %a(href="http://www.suntran.com/webwatch/") Click here for SunTran's site
        %p The WebWatch services uses this feed:
        %a(href="http://www.suntran.com/webwatch/UpdateWebMap.aspx?u=1") http://www.suntran.com/webwatch/UpdateWebMap.aspx?u=1
        %h3 GETful API (currently only returns XML, JSON possible in future)
        %a(href="http://busted.kitplummer.apigee.com/alpha/routes/") http://busted.kitplummer.apigee.com/alpha/routes/ - Returns listing of routes
        %br
        %a(href="http://busted.kitplummer.apigee.com/alpha/route/1") http://busted.kitplummer.apigee.com/alpha/route/1 - Returns all information
        %br
        %a(href="http://busted.kitplummer.apigee.com/alpha/route/1/stations") http://busted.kitplummer.apigee.com/alpha/route/1/stations - Returns all stations for route
        %br
        %a(href="http://busted.kitplummer.apigee.com/alpha/route/1/stops") http://busted.kitplummer.apigee.com/alpha/route/1/stops - Returns all stops (including stations) for route
        %br
        %a(href="http://busted.kitplummer.apigee.com/alpha/route/1/busses") http://busted.kitplummer.apigee.com/alpha/route/1/busses - Returns all busses on route, including positions
        %br
        %h3 KML for Google Earth/Maps, Other Mapping Tools
        %p Just scratching KML support...but here's a taste (I've tested in Google Earth).  For the sake of debugging I've not set the content_type to application/vnd.google-earth.kml+xml yet, because it is a dev/debug pain.  So, if you just want to download, you'll have to SaveAs from your browser.
        %a(href="http://busted.kitplummer.apigee.com/alpha/route/1/busses.kml") http://busted.kitplummer.apigee.com/alpha/route/1/busses.kml
        %p Here's a way to overlay route traces onto Google Earth.  It is just lines, without markers indicating stops.  Working on that now.
        %a(href="http://busted.kitplummer.apigee.com/alpha/route/1/trace.kml") http://busted.kitplummer.apigee.com/alpha/route/1/trace.kml
        %p To get the KML into Google Earth is pretty simple.  Select "Add" from the Google Earth menu, then click "Network Link".
        %image(src="images/ge_menu.png")
        %p Then, add a simple name, and copy the link in.
        %image(src="images/ge_netlink.png")
        %p Clock "OK", and the trace will appear in the map.
        %image(src="images/ge_trace.png")
        %p To get the busses to appear on the map, follow the same steps but use the busses.kml for that route. 
        %p The code for this thing is available at:
        %a(href="http://github.com/kitplummer/Busted") http://github.com/kitplummer/Busted
        %p I've decided to test the Apigee (http://www.apigee.com) service's analytics capabilities and use them to provide a basic filter and protection around the service at Heroku.  I'll post some basic numbers soon.